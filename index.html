<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tatti Players - Profiles</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js CDN for analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
    <!-- Bootstrap Icons for Music Player -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        /* Base CSS for Tatti Players */
        :root {
            --dark-bg: #0c1524;
            --darker-bg: #080e1a;
            --accent-blue: #00f0ff;
            --accent-purple: #8a2be2;
            --accent-pink: #ff00d0;
            --surface-color: #121b2b;
            --card-color: #1a2539;
            --border-color: #2a3a54;
            --text-primary: #e0f7ff;
            --text-secondary: #a0b8c8;
            --status-success: #00e676;
            --status-warning: #ff9100;
            --status-danger: #ff1744;
            --highlight-effect: rgba(0, 240, 255, 0.15);

            /* Music Player Specific Variables (default to original theme) */
            --mp-background-gradient-start: #161b22;
            --mp-background-gradient-end: #0d1117;
            --mp-album-art-gradient-start: var(--accent-purple);
            --mp-album-art-gradient-end: var(--accent-pink);
            --mp-album-art-shadow: rgba(110, 64, 201, 0.4);
            --mp-progress-bar-bg: #30363d;
            --mp-progress-gradient-start: var(--accent-purple);
            --mp-progress-gradient-end: var(--accent-blue);
            --mp-control-btn-hover-color: var(--accent-blue);
            --mp-control-btn-active-color: var(--accent-purple);
            --mp-time-info-color: var(--text-secondary);
        }

        /* Light Theme */
        body.light-theme {
            --dark-bg: #e0f2f7;
            --darker-bg: #f0f8fa;
            --accent-blue: #1e88e5;
            --accent-purple: #673ab7;
            --accent-pink: #d81b60;
            --surface-color: #ffffff;
            --card-color: #f5f5f5;
            --border-color: #cfd8dc;
            --text-primary: #263238;
            --text-secondary: #546e7a;
            --status-success: #388e3c;
            --status-warning: #fbc02d;
            --status-danger: #d32f2f;
            --highlight-effect: rgba(30, 136, 229, 0.15);

            /* Music Player Specific Variables for Light Theme */
            --mp-background-gradient-start: #f0f8fa;
            --mp-background-gradient-end: #e0f2f7;
            --mp-album-art-gradient-start: var(--accent-purple);
            --mp-album-art-gradient-end: var(--accent-pink);
            --mp-album-art-shadow: rgba(103, 58, 183, 0.4);
            --mp-progress-bar-bg: #cfd8dc;
            --mp-progress-gradient-start: var(--accent-purple);
            --mp-progress-gradient-end: var(--accent-blue);
            --mp-control-btn-hover-color: var(--accent-blue);
            --mp-control-btn-active-color: var(--accent-purple);
            --mp-time-info-color: var(--text-secondary);
        }

        /* Cyberpunk Theme */
        body.cyberpunk-theme {
            --dark-bg: #0d0d0d;
            --darker-bg: #050505;
            --accent-blue: #00ffff; /* Cyber Blue */
            --accent-purple: #ff00ff; /* Magenta */
            --accent-pink: #ffea00; /* Neon Yellow */
            --surface-color: #1a1a1a;
            --card-color: #2a2a2a;
            --border-color: #00ffff; /* Borders glow */
            --text-primary: #00ff00; /* Neon Green */
            --text-secondary: #00ccff; /* Lighter Cyber Blue */
            --status-success: #00ff00;
            --status-warning: #ffea00;
            --status-danger: #ff3300;
            --highlight-effect: rgba(0, 255, 255, 0.25);

            /* Music Player Specific Variables for Cyberpunk Theme */
            --mp-background-gradient-start: #1a1a1a;
            --mp-background-gradient-end: #050505;
            --mp-album-art-gradient-start: var(--accent-purple);
            --mp-album-art-gradient-end: var(--accent-pink);
            --mp-album-art-shadow: rgba(255, 0, 255, 0.4);
            --mp-progress-bar-bg: #3a3a3a;
            --mp-progress-gradient-start: var(--accent-purple);
            --mp-progress-gradient-end: var(--accent-blue);
            --mp-control-btn-hover-color: var(--accent-blue);
            --mp-control-btn-active-color: var(--accent-purple);
            --mp-time-info-color: var(--text-secondary);
        }

        /* Hacker Theme */
        body.hacker-theme {
            --dark-bg: #0a0a0a;
            --darker-bg: #001a00;
            --accent-blue: #00ff00;
            --accent-purple: #00aa00;
            --accent-pink: #00ff88;
            --surface-color: #0a1a0a;
            --card-color: #0f2a0f;
            --border-color: #004400;
            --text-primary: #00ff00;
            --text-secondary: #009900;
            --status-success: #00ff00;
            --status-warning: #ffff00;
            --status-danger: #ff0000;
            --highlight-effect: rgba(0, 255, 0, 0.15);

            /* Music Player Specific Variables for Hacker Theme */
            --mp-background-gradient-start: #0a1a0a;
            --mp-background-gradient-end: #001a00;
            --mp-album-art-gradient-start: var(--accent-purple);
            --mp-album-art-gradient-end: var(--accent-pink);
            --mp-album-art-shadow: rgba(0, 170, 0, 0.4);
            --mp-progress-bar-bg: #003300;
            --mp-progress-gradient-start: var(--accent-purple);
            --mp-progress-gradient-end: var(--accent-blue);
            --mp-control-btn-hover-color: var(--accent-blue);
            --mp-control-btn-active-color: var(--accent-purple);
            --mp-time-info-color: var(--text-secondary);
        }

        /* Royal Theme */
        body.royal-theme {
            --dark-bg: #1a0a33;
            --darker-bg: #0d0519;
            --accent-blue: #9b59b6;
            --accent-purple: #8e44ad;
            --accent-pink: #e74c3c;
            --surface-color: #2c0d4d;
            --card-color: #3d1a66;
            --border-color: #5d2d8b;
            --text-primary: #f5d6ff;
            --text-secondary: #c9a0dc;
            --status-success: #2ecc71;
            --status-warning: #f39c12;
            --status-danger: #e74c3c;
            --highlight-effect: rgba(155, 89, 182, 0.15);

            /* Music Player Specific Variables for Royal Theme */
            --mp-background-gradient-start: #2c0d4d;
            --mp-background-gradient-end: #1a0a33;
            --mp-album-art-gradient-start: var(--accent-purple);
            --mp-album-art-gradient-end: var(--accent-pink);
            --mp-album-art-shadow: rgba(142, 68, 173, 0.4);
            --mp-progress-bar-bg: #5d2d8b;
            --mp-progress-gradient-start: var(--accent-purple);
            --mp-progress-gradient-end: var(--accent-blue);
            --mp-control-btn-hover-color: var(--accent-blue);
            --mp-control-btn-active-color: var(--accent-purple);
            --mp-time-info-color: var(--text-secondary);
        }

        /* Anime Theme */
        body.anime-theme {
            --dark-bg: #1e1e2e;
            --darker-bg: #161622;
            --accent-blue: #89dceb;
            --accent-purple: #cba6f7;
            --accent-pink: #f5c2e7;
            --surface-color: #2a2a3a;
            --card-color: #3a3a4a;
            --border-color: #585b70;
            --text-primary: #cdd6f4;
            --text-secondary: #a6adc8;
            --status-success: #a6e3a1;
            --status-warning: #f9e2af;
            --status-danger: #f38ba8;
            --highlight-effect: rgba(137, 220, 235, 0.15);

            /* Music Player Specific Variables for Anime Theme */
            --mp-background-gradient-start: #2a2a3a;
            --mp-background-gradient-end: #1e1e2e;
            --mp-album-art-gradient-start: var(--accent-purple);
            --mp-album-art-gradient-end: var(--accent-pink);
            --mp-album-art-shadow: rgba(203, 166, 247, 0.4);
            --mp-progress-bar-bg: #585b70;
            --mp-progress-gradient-start: var(--accent-purple);
            --mp-progress-gradient-end: var(--accent-blue);
            --mp-control-btn-hover-color: var(--accent-blue);
            --mp-control-btn-active-color: var(--accent-purple);
            --mp-time-info-color: var(--text-secondary);
        }


        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif; /* Changed to Inter */
        }

        html {
            /* For Firefox */
            scrollbar-width: none;
        }

        /* For Chrome, Safari, and Edge */
        html::-webkit-scrollbar {
            display: none;
        }

        body {
            background: radial-gradient(circle at top, var(--dark-bg), var(--darker-bg));
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            /* Removed overflow: hidden; to allow scrolling */
        }

        /* Background effect */
        .dynamic-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .dynamic-particle {
            position: absolute;
            border-radius: 50%;
            background: var(--accent-blue);
            opacity: 0.2;
            animation: float 15s infinite linear;
            filter: blur(1px);
        }

        @keyframes float {
            0% { transform: translate(0, 0); }
            25% { transform: translate(100px, 50px); }
            50% { transform: translate(200px, 0); }
            75% { transform: translate(100px, -50px); }
            100% { transform: translate(0, 0); }
        }

        /* Header styling */
        .site-header {
            background: rgba(12, 21, 36, 0.8);
            backdrop-filter: blur(10px);
            padding: 25px 0;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
            position: relative;
            z-index: 10;
        }

        body.light-theme .site-header {
            background: rgba(255, 255, 255, 0.8);
        }

        body.cyberpunk-theme .site-header, body.hacker-theme .site-header, body.royal-theme .site-header, body.anime-theme .site-header {
            background: rgba(0, 0, 0, 0.8);
            border-bottom: 1px solid var(--border-color);
        }

        .site-header h1 {
            margin: 0;
            font-size: 2.8rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
        }

        .site-header p {
            font-size: 1.2rem;
            color: var(--text-secondary);
            max-width: 800px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .user-id-display {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        .user-id-display i {
            color: var(--accent-blue);
        }
        .user-id-display span {
            font-weight: 600;
            color: var(--text-primary);
        }

        .display-name-input-container {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            padding: 0 20px;
        }

        .display-name-input-container input[type="text"] {
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: var(--surface-color);
            color: var(--text-primary);
            font-size: 1rem;
            width: 250px;
            max-width: 100%;
        }

        .display-name-input-container button {
            background: linear-gradient(90deg, var(--accent-pink), var(--accent-purple));
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(255, 0, 208, 0.3);
        }

        .display-name-input-container button:hover {
            opacity: 0.9;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(255, 0, 208, 0.4);
        }


        /* Navigation - Now for Side Drawer */
        .hamburger-btn {
            position: absolute;
            top: 25px;
            left: 20px;
            background: none;
            border: none;
            color: var(--accent-blue);
            font-size: 1.8rem;
            cursor: pointer;
            z-index: 101; /* Above header content */
            transition: color 0.3s ease, transform 0.2s ease; /* Added transform */
        }

        .hamburger-btn:hover {
            color: var(--text-primary);
        }

        .hamburger-btn.clicked { /* Added for visual feedback */
            color: var(--accent-pink);
            transform: scale(1.1);
        }

        .side-drawer {
            position: fixed;
            top: 0;
            left: -300px; /* Hidden by default */
            width: 280px; /* Width of the drawer */
            height: 100%;
            background: var(--card-color);
            z-index: 1000;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.5);
            transition: left 0.3s ease-in-out;
            padding-top: 80px; /* Space for header */
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border-color);
        }

        .side-drawer.open {
            left: 0; /* Show the drawer */
        }

        .drawer-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none; /* Hidden by default */
            opacity: 0;
            z-index: 999;
            transition: opacity 0.3s ease-in-out;
        }

        .drawer-overlay.visible {
            display: block; /* Ensure it becomes block for visibility */
            opacity: 1;
        }

        .main-nav {
            display: flex;
            flex-direction: column; /* Vertical links */
            padding: 20px 0;
        }

        .main-nav a {
            color: var(--text-secondary);
            text-decoration: none;
            padding: 15px 25px;
            margin: 5px 0;
            border-radius: 8px; /* Slightly less rounded for vertical list */
            transition: all 0.3s ease;
            font-weight: 500;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            display: flex; /* For icon and text alignment */
            align-items: center;
            gap: 15px;
        }

        .main-nav a i {
            font-size: 1.2rem;
            color: var(--accent-blue);
        }

        .main-nav a::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, var(--highlight-effect), transparent);
            transform: translateX(-100%);
            transition: transform 0.5s ease;
        }

        .main-nav a:hover {
            color: var(--text-primary);
            background: rgba(0, 240, 255, 0.1);
        }

        .main-nav a.active {
            color: var(--accent-blue);
            background: var(--highlight-effect);
            border-left: 4px solid var(--accent-blue); /* Highlight active link */
            padding-left: 21px; /* Adjust for border */
        }

        /* Dashboard layout */
        .dashboard {
            max-width: 1400px;
            margin: 40px auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
        }

        .dashboard-header h2 {
            font-size: 1.8rem;
            font-weight: 600;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        /* Profile cards */
        .members-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            position: relative;
        }

        .profile-card {
            background: var(--card-color);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-color);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            z-index: 2;
        }

        .profile-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.4);
        }

        .profile-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
        }

        .profile-header {
            display: flex;
            padding: 40px 25px 25px 25px;
            border-bottom: 1px solid var(--border-color);
            gap: 20px;
            align-items: center;
            min-height: 120px;
        }

        .profile-image {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border: 3px solid var(--surface-color);
            position: relative;
        }

        .profile-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Modified to show a user icon when no image is present */
        .profile-image .fa-user-circle {
            font-size: 3.5rem; /* Larger icon size */
            color: var(--text-primary);
            opacity: 0.7;
        }

        .profile-image::after {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            border-radius: 50%;
            border: 2px solid var(--accent-blue);
            animation: profile-pulse 2s infinite; /* Renamed animation */
        }

        @keyframes profile-pulse { /* Renamed animation */
            0% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
            100% { opacity: 0.5; transform: scale(1); }
        }

        .profile-info {
            flex: 1;
        }

        .profile-info h2 {
            font-size: 1.5rem;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .profile-status {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-online {
            background: rgba(0, 230, 118, 0.15);
            color: var(--status-success);
            border: 1px solid var(--status-success);
        }
        
        .status-busy {
            background: rgba(255, 145, 0, 0.15);
            color: var(--status-warning);
            border: 1px solid var(--status-warning);
        }

        .status-away {
            background: rgba(255, 145, 0, 0.15);
            color: var(--status-warning);
            border: 1px solid var(--status-warning);
        }

        .status-offline {
            background: rgba(255, 23, 68, 0.15);
            color: var(--status-danger);
            border: 1px solid var(--status-danger);
        }

        .profile-meta {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .profile-meta div {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .profile-meta i {
            color: var(--accent-blue);
        }

        .profile-content {
            padding: 25px;
        }

        .profile-description {
            font-size: 0.95rem;
            color: var(--text-secondary);
            margin-bottom: 20px;
            line-height: 1.7;
        }

        .trait-list {
            list-style: none;
            margin-bottom: 25px;
        }

        .trait-list li {
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            gap: 10px;
        }

        .trait-list li:last-child {
            border-bottom: none;
        }

        .trait-list i {
            color: var(--accent-blue);
            min-width: 20px;
        }

        .trait-list strong {
            color: var(--text-primary);
        }

        /* Analytics Page Specific Styling */
        .analytics-content {
            background: var(--card-color);
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-color);
            padding: 30px;
            margin-top: 30px;
        }

        .analytics-content h2 {
            font-size: 2rem;
            margin-bottom: 20px;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-pink));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .analytics-content p {
            color: var(--text-secondary);
            font-size: 1.1rem;
            line-height: 1.8;
            margin-bottom: 15px;
        }

        /* Chart styling */
        .chart-container {
            position: relative;
            width: 100%;
            height: 300px;
            margin-top: 30px;
        }
        
        .analytics-card { /* Kept for general analytics cards if any are added later */
            background: var(--surface-color);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid var(--border-color);
            text-align: center;
        }

        .analytics-card h3 {
            font-size: 1.5rem;
            color: var(--accent-blue);
            margin-bottom: 10px;
        }

        .analytics-card p {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--text-primary);
        }

        /* Canvas styling */
        #playerBarChart {
            display: block;
            background-color: var(--surface-color);
            border-radius: 10px;
            border: 1px solid var(--border-color);
            margin-top: 30px;
            width: 100%; /* Make canvas responsive */
            height: 300px; /* Fixed height for consistency */
        }

        /* Page content display using classes */
        .page-content {
            display: none; /* Hide all pages by default */
        }

        .page-content.active-page {
            display: grid; /* Show active page as grid by default */
        }

        /* Player Description Styling */
        .player-description-card {
            background: var(--surface-color);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid var(--border-color);
            margin-top: 20px;
            text-align: left;
            grid-column: 1 / -1; /* Span across all columns in the grid */
            display: flex; /* Use flex to align content and button */
            flex-direction: column; /* Stack content vertically */
        }
        .player-description-card h3 {
            color: var(--accent-pink);
            margin-bottom: 10px;
        }
        .player-description-card p {
            font-size: 1rem;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 15px; /* Add margin below paragraph */
        }
        .player-description-card .actions {
            display: flex;
            justify-content: flex-end; /* Align button to the right */
            margin-top: auto; /* Push actions to the bottom */
        }
        .player-description-card .delete-btn {
            background-color: var(--status-danger);
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .player-description-card .delete-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }


        /* Custom Modal Styling */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none; /* Changed to none by default */
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0; /* Start hidden */
            pointer-events: none; /* Prevent interaction when hidden */
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            transform: scale(0.95); /* Initial scale for animation */
        }

        .modal-overlay.visible {
            opacity: 1;
            pointer-events: auto;
            transform: scale(1);
        }

        .modal-content {
            background: var(--card-color);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            text-align: center;
            max-width: 400px;
            width: 90%;
            border: 1px solid var(--border-color);
        }

        .modal-content p {
            font-size: 1.2rem;
            color: var(--text-primary);
            margin-bottom: 25px;
        }

        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .modal-btn {
            padding: 10px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-btn.confirm-yes {
            background: linear-gradient(90deg, #00e676, #00c853);
            color: white;
        }

        .modal-btn.confirm-no {
            background: linear-gradient(90deg, #ff1744, #d50000);
            color: white;
        }

        .modal-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        /* Welcome Modal Specific Styling */
        #welcomeModal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none; /* Changed to none by default */
            justify-content: center;
            align-items: center;
            z-index: 1001; /* Higher than other modals */
            flex-direction: column;
            gap: 20px;
            padding: 20px;
            opacity: 0; /* Start hidden */
            pointer-events: none; /* Prevent interaction when hidden */
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            transform: scale(0.95); /* Initial scale for animation */
        }

        #welcomeModal.visible {
            opacity: 1;
            pointer-events: auto;
            transform: scale(1);
        }

        #welcomeModal .modal-content {
            background: var(--dark-bg);
            border: 2px solid var(--accent-blue);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0, 240, 255, 0.3);
            max-width: 500px;
        }

        #welcomeModal h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-pink));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        #welcomeModal p {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 30px;
        }

        #welcomeModal input[type="text"] {
            width: calc(100% - 30px); /* Adjust for padding */
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            background-color: var(--surface-color);
            color: var(--text-primary);
            font-size: 1.1rem;
            margin-bottom: 20px;
            text-align: center;
        }

        #welcomeModal button {
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 240, 255, 0.4);
        }

        #welcomeModal button:hover {
            opacity: 0.9;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 240, 255, 0.5);
        }

        /* Utility class to hide main content */
        .main-content {
            display: none; /* Changed to none by default */
            opacity: 0; /* Start hidden */
            pointer-events: none; /* Prevent interaction when hidden */
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            transform: translateY(20px); /* Initial position for animation */
        }

        .main-content.visible {
            opacity: 1;
            pointer-events: auto;
            transform: translateY(0);
        }

        /* Admin Page Specific Styling */
        .admin-content {
            background: var(--card-color);
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-color);
            padding: 30px;
            margin-top: 30px;
        }

        .admin-content h2 {
            font-size: 2rem;
            margin-bottom: 20px;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-pink));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .admin-content p {
            color: var(--text-secondary);
            font-size: 1.1rem;
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .admin-pin-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            padding: 20px;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            background-color: var(--surface-color);
            margin-top: 20px;
        }

        .admin-pin-section input[type="password"] {
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: var(--darker-bg);
            color: var(--text-primary);
            font-size: 1rem;
            width: 250px;
            max-width: 100%;
            text-align: center;
        }

        .admin-pin-section button {
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 240, 255, 0.3);
        }

        .admin-pin-section button:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 240, 255, 0.4);
        }

        #revokeAdminBtn {
            background-color: var(--status-danger);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            display: block; /* Ensure it's on its own line */
            margin-left: auto;
            margin-right: auto;
        }
        #revokeAdminBtn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        /* Theme Selector Styling */
        .theme-selector {
            margin-top: 30px;
        }

        .theme-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); /* Responsive grid for themes */
            gap: 15px;
            margin-top: 15px;
        }

        .theme-btn {
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 600;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .theme-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .theme-btn.active-theme {
            border: 2px solid var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(0, 240, 255, 0.3);
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .main-nav {
                flex-wrap: wrap;
                padding: 10px;
                justify-content: center;
            }
            
            .main-nav a {
                padding: 8px 15px;
                margin: 5px;
                font-size: 0.9rem;
            }
            
            .dashboard-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .profile-header {
                flex-direction: column;
                text-align: center;
                padding: 60px 20px 20px 20px;
                min-height: 150px;
            }
            
            .profile-meta {
                justify-content: center;
            }
            
            .members-grid {
                grid-template-columns: 1fr;
            }

            .display-name-input-container {
                flex-direction: column;
                gap: 8px;
            }

            .display-name-input-container input[type="text"] {
                width: 100%;
            }

            #welcomeModal .modal-content {
                padding: 30px 20px;
            }

            #welcomeModal h2 {
                font-size: 2rem;
            }

            #welcomeModal input[type="text"] {
                width: 100%;
            }

            .admin-pin-section input[type="password"] {
                width: 100%;
            }
            
            .theme-options {
                grid-template-columns: 1fr;
            }

            .music-player {
                padding: 20px;
                margin: 10px;
            }
            .album-art {
                width: 150px;
                height: 150px;
            }
            .album-art i {
                font-size: 40px;
            }
            .song-title {
                font-size: 18px;
            }
            .song-artist {
                font-size: 14px;
            }
            .controls {
                gap: 15px;
            }
            .control-btn.large {
                width: 40px;
                height: 40px;
                font-size: 24px;
            }
        }

        /* New styles for editable player profiles */
        .profile-card.editing {
            border: 2px solid var(--accent-blue);
            box-shadow: 0 0 20px var(--highlight-effect);
        }

        .profile-card .editable-field {
            margin-bottom: 10px;
        }

        .profile-card .editable-field label {
            display: block;
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }

        .profile-card .editable-field input[type="text"],
        .profile-card .editable-field input[type="number"],
        .profile-card .editable-field textarea,
        .profile-card .editable-field select {
            width: 100%;
            padding: 8px 12px;
            border-radius: 5px;
            border: 1px solid var(--border-color);
            background-color: var(--darker-bg);
            color: var(--text-primary);
            font-size: 0.95rem;
            resize: vertical;
            min-height: 38px; /* Ensure consistent height for inputs */
        }

        .profile-card .editable-field textarea {
            min-height: 80px;
        }

        .profile-card .player-actions {
            margin-top: 20px;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .profile-card .player-actions button {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .profile-card .player-actions .edit-player-btn {
            background: var(--accent-blue);
            color: var(--darker-bg);
        }

        .profile-card .player-actions .save-player-btn {
            background: var(--status-success);
            color: white;
        }

        .profile-card .player-actions .cancel-player-btn {
            background: var(--text-secondary);
            color: var(--darker-bg);
        }

        .profile-card .player-actions button:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        /* Music Player Styles (integrated and adapted) */
        .music-player-container {
            /* Removed display: flex; from here */
            justify-content: center;
            align-items: center;
            padding: 30px; /* Added padding to ensure it's not flush with page edges */
            min-height: calc(100vh - 150px); /* Adjust based on header/footer height */
        }
        /* Specific rule to make audio player page flex when active */
        #audio-player-page.active-page {
            display: flex;
        }

        .music-player {
            width: 100%;
            max-width: 500px;
            margin: 20px;
            background: linear-gradient(145deg, var(--mp-background-gradient-start), var(--mp-background-gradient-end));
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        .album-art {
            width: 200px;
            height: 200px;
            margin: 0 auto 25px;
            border-radius: 10px;
            background: linear-gradient(45deg, var(--mp-album-art-gradient-start), var(--mp-album-art-gradient-end));
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 15px var(--mp-album-art-shadow);
            cursor: pointer;
            transition: transform 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .album-art:hover {
            transform: scale(1.03);
        }
        
        .album-art.playing::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(0.95); opacity: 0.7; }
            50% { transform: scale(1.05); opacity: 0.9; }
            100% { transform: scale(0.95); opacity: 0.7; }
        }
        
        .album-art i {
            font-size: 60px;
            color: white;
            opacity: 0.8;
            transition: all 0.3s ease;
        }
        
        .album-art:hover i {
            opacity: 1;
            transform: scale(1.1);
        }
        
        .song-info {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .song-title {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--text-primary); /* Use theme primary text color */
        }
        
        .song-artist {
            font-size: 16px;
            color: var(--text-secondary); /* Use theme secondary text color */
        }
        
        .progress-container {
            margin: 25px 0;
        }
        
        .progress-bar {
            height: 4px;
            background: var(--mp-progress-bar-bg);
            border-radius: 2px;
            margin-bottom: 5px;
            cursor: pointer;
        }
        
        .progress {
            height: 100%;
            width: 0%;
            background: linear-gradient(to right, var(--mp-progress-gradient-start), var(--mp-progress-gradient-end));
            border-radius: 2px;
            position: relative;
            transition: width 0.1s linear;
        }
        
        .progress::after {
            content: '';
            position: absolute;
            right: -5px;
            top: -3px;
            width: 10px;
            height: 10px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 5px rgba(255, 255, 255, 0.8);
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        
        .progress-bar:hover .progress::after {
            opacity: 1;
        }
        
        .time-info {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--mp-time-info-color);
        }
        
        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 25px;
            margin-top: 20px;
        }
        
        .control-btn {
            background: none;
            border: none;
            color: var(--text-primary); /* Use theme primary text color */
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s;
            padding: 10px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .control-btn:hover {
            color: var(--mp-control-btn-hover-color);
            transform: scale(1.1);
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .control-btn.active {
            color: var(--mp-control-btn-active-color);
        }
        
        .control-btn.large {
            font-size: 28px;
            width: 50px;
            height: 50px;
        }
        
        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 25px;
        }
        
        .volume-slider {
            flex-grow: 1;
            -webkit-appearance: none;
            height: 4px;
            background: var(--mp-progress-bar-bg);
            border-radius: 2px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .volume-slider:hover {
            height: 6px;
        }
        
        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 12px;
            height: 12px;
            background: white;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .volume-slider:hover::-webkit-slider-thumb {
            width: 14px;
            height: 14px;
        }
    </style>
</head>
<body>
    <!-- Background particles -->
    <div class="dynamic-background" id="dynamic-bg"></div>
    
    <header class="site-header">
        <button id="hamburgerBtn" class="hamburger-btn" aria-label="Open navigation menu">
            <i class="fas fa-bars"></i>
        </button>
        <h1>Tatti Players</h1>
        <p>Player Profiles & Analytics</p>
        <div class="user-id-display">
            <i class="fas fa-user-circle"></i> Your Display Name: <span id="displayUserId">Loading...</span>
        </div>
        <div class="display-name-input-container">
            <input type="text" id="displayNameInput" placeholder="Change your display name">
            <button id="saveDisplayNameBtn">Save Name</button>
        </div>
    </header>

    <!-- Side Drawer -->
    <div id="sideDrawer" class="side-drawer">
        <nav class="main-nav">
            <a href="#" class="nav-link active" data-target="dashboard-page"><i class="fas fa-home"></i> Dashboard</a>
            <a href="#" class="nav-link" data-target="analytics-page"><i class="fas fa-chart-line"></i> Analytics</a>
            <a href="#" class="nav-link" data-target="audio-player-page"><i class="fas fa-music"></i> Audio Player</a>
            <a href="#" class="nav-link" data-target="settings-page"><i class="fas fa-cog"></i> Settings</a>
        </nav>
    </div>

    <!-- Drawer Overlay -->
    <div id="drawerOverlay" class="drawer-overlay"></div>

    <div class="main-content" style="display: none;">
        <!-- Dashboard Page Content -->
        <div id="dashboard-page" class="dashboard page-content active-page">
            <div class="dashboard-header">
                <div>
                    <h2><i class="fas fa-users"></i> Player Profiles</h2>
                </div>
            </div>

            <div class="members-grid" id="playerProfilesGrid">
                <!-- Player profiles will be dynamically loaded here -->
            </div>
        </div>

        <!-- Analytics Page Content -->
        <div id="analytics-page" class="dashboard page-content">
            <div class="analytics-content">
                <h2><i class="fas fa-chart-line"></i> Tatti Analytics</h2>
                <p>Here you can view your players' performance and stats.</p>
                
                <div class="chart-container">
                    <canvas id="playerBarChart"></canvas>
                </div>

                <!-- Player Description Container -->
                <div id="playerDescriptions" style="margin-top: 20px;">
                    <!-- Descriptions will be dynamically inserted here -->
                </div>
            </div>
        </div>

        <!-- Audio Player Page Content -->
        <div id="audio-player-page" class="dashboard page-content music-player-container">
            <div class="music-player">
                <div class="album-art" id="albumArt">
                    <i class="bi bi-github" id="albumIcon"></i>
                </div>
                
                <div class="song-info">
                    <div class="song-title" id="songTitle">Push to Main</div>
                    <div class="song-artist" id="songArtist">GitHub Beats</div>
                </div>
                
                <div class="progress-container">
                    <div class="progress-bar" id="progressBar">
                        <div class="progress" id="progress"></div>
                    </div>
                    <div class="time-info">
                        <span id="currentTime">0:00</span>
                        <span id="duration">0:00</span>
                    </div>
                </div>
                
                <div class="controls">
                    <button class="control-btn" id="shuffleBtn" aria-label="Shuffle">
                        <i class="bi bi-shuffle"></i>
                    </button>
                    <button class="control-btn" id="prevBtn" aria-label="Previous">
                        <i class="bi bi-skip-start-fill"></i>
                    </button>
                    <button class="control-btn large" id="playBtn" aria-label="Play/Pause">
                        <i class="bi bi-play-circle-fill" id="playIcon"></i>
                    </button>
                    <button class="control-btn" id="nextBtn" aria-label="Next">
                        <i class="bi bi-skip-end-fill"></i>
                    </button>
                    <button class="control-btn" id="repeatBtn" aria-label="Repeat">
                        <i class="bi bi-arrow-repeat"></i>
                    </button>
                </div>
                
                <div class="volume-control">
                    <i class="bi bi-volume-down"></i>
                    <input type="range" class="volume-slider" id="volumeSlider" value="70" min="0" max="100">
                    <i class="bi bi-volume-up"></i>
                </div>
            </div>
        </div>

        <!-- Settings Page Content -->
        <div id="settings-page" class="dashboard page-content">
            <div class="analytics-content">
                <h2><i class="fas fa-cog"></i> Settings</h2>
                <p>Here you can manage your app settings.</p>
                
                <div class="theme-selector">
                    <h3>Select Theme:</h3>
                    <div class="theme-options">
                        <button class="theme-btn active-theme" data-theme="original">
                            <i class="fas fa-palette"></i><br>
                            Original
                        </button>
                        <button class="theme-btn" data-theme="hacker">
                            <i class="fas fa-code"></i><br>
                            Hacker
                        </button>
                        <button class="theme-btn" data-theme="royal">
                            <i class="fas fa-crown"></i><br>
                            Royal
                        </button>
                        <button class="theme-btn" data-theme="anime">
                            <i class="fas fa-dragon"></i><br>
                            Anime
                        </button>
                    </div>
                </div>

                <!-- Admin Panel Content - Moved Here -->
                <div class="admin-content" style="margin-top: 40px;">
                    <h2><i class="fas fa-user-shield"></i> Admin Panel</h2>
                    <p>Here you can manage your own admin status.</p>
                    
                    <!-- Admin PIN Section (initially visible if not admin) -->
                    <div id="adminPinSection" class="admin-pin-section">
                        <h3>Enter Admin PIN</h3>
                        <input type="password" id="adminPinInput" placeholder="Enter PIN to gain admin access">
                        <button id="grantAdminBtn">Grant Admin Access</button>
                    </div>

                    <!-- Admin User List Section (initially hidden) -->
                    <div id="adminUserListSection" style="display: none;">
                        <p>You currently have admin privileges.</p>
                        <button id="revokeAdminBtn">Revoke Admin Access</button>
                    </div>
                </div>
            </div>
        </div>

    </div> <!-- End of main-content -->

    <!-- Custom Confirmation Modal -->
    <div id="customConfirmModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <p id="confirmMessage"></p>
            <div class="modal-buttons">
                <button id="confirmYesBtn" class="modal-btn confirm-yes">Yes</button>
                <button id="confirmNoBtn" class="modal-btn confirm-no">No</button>
            </div>
        </div>
    </div>

    <!-- Welcome Modal for Display Name -->
    <div id="welcomeModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2>Welcome to Tatti Players!</h2>
            <p>Please enter a display name to start exploring the app.</p>
            <input type="text" id="welcomeDisplayNameInput" placeholder="Enter your display name" required>
            <button id="startExploringBtn">Start Exploring</button>
        </div>
    </div>

    <script>
        // Global variables
        let userId; 
        let userDisplayName = ""; 
        let isAdmin = false; 
        let currentTheme = 'original'; 
        
        const ADMIN_PIN = "6789"; 

        // Local Storage Keys
        const LOCAL_PROFILE_KEY_PREFIX = 'tatti_userProfile_';

        // Theme configurations
        const themes = {
            original: {
                '--dark-bg': '#0c1524',
                '--darker-bg': '#080e1a',
                '--accent-blue': '#00f0ff',
                '--accent-purple': '#8a2be2',
                '--accent-pink': '#ff00d0',
                '--surface-color': '#121b2b',
                '--card-color': '#1a2539',
                '--border-color': '#2a3a54',
                '--text-primary': '#e0f7ff',
                '--text-secondary': '#a0b8c8',
                '--status-success': '#00e676',
                '--status-warning': '#ff9100',
                '--status-danger': '#ff1744',
                // Music Player Specific Variables (default to original theme)
                '--mp-background-gradient-start': '#161b22',
                '--mp-background-gradient-end': '#0d1117',
                '--mp-album-art-gradient-start': '#8a2be2',
                '--mp-album-art-gradient-end': '#ff00d0',
                '--mp-album-art-shadow': 'rgba(110, 64, 201, 0.4)',
                '--mp-progress-bar-bg': '#30363d',
                '--mp-progress-gradient-start': '#8a2be2',
                '--mp-progress-gradient-end': '#00f0ff',
                '--mp-control-btn-hover-color': '#00f0ff',
                '--mp-control-btn-active-color': '#8a2be2',
                '--mp-time-info-color': '#a0b8c8'
            },
            hacker: {
                '--dark-bg': '#0a0a0a',
                '--darker-bg': '#001a00',
                '--accent-blue': '#00ff00',
                '--accent-purple': '#00aa00',
                '--accent-pink': '#00ff88',
                '--surface-color': '#0a1a0a',
                '--card-color': '#0f2a0f',
                '--border-color': '#004400',
                '--text-primary': '#00ff00',
                '--text-secondary': '#009900',
                '--status-success': '#00ff00',
                '--status-warning': '#ffff00',
                '--status-danger': '#ff0000',
                '--highlight-effect': 'rgba(0, 255, 0, 0.15)',
                // Music Player Specific Variables for Hacker Theme
                '--mp-background-gradient-start': '#0a1a0a',
                '--mp-background-gradient-end': '#001a00',
                '--mp-album-art-gradient-start': '#00aa00',
                '--mp-album-art-gradient-end': '#00ff88',
                '--mp-album-art-shadow': 'rgba(0, 170, 0, 0.4)',
                '--mp-progress-bar-bg': '#003300',
                '--mp-progress-gradient-start': '#00aa00',
                '--mp-progress-gradient-end': '#00ff00',
                '--mp-control-btn-hover-color': '#00ff00',
                '--mp-control-btn-active-color': '#00aa00',
                '--mp-time-info-color': '#009900'
            },
            royal: {
                '--dark-bg': '#1a0a33',
                '--darker-bg': '#0d0519',
                '--accent-blue': '#9b59b6',
                '--accent-purple': '#8e44ad',
                '--accent-pink': '#e74c3c',
                '--surface-color': '#2c0d4d',
                '--card-color': '#3d1a66',
                '--border-color': '#5d2d8b',
                '--text-primary': '#f5d6ff',
                '--text-secondary': '#c9a0dc',
                '--status-success': '#2ecc71',
                '--status-warning': '#f39c12',
                '--status-danger': '#e74c3c',
                '--highlight-effect': 'rgba(155, 89, 182, 0.15)',
                // Music Player Specific Variables for Royal Theme
                '--mp-background-gradient-start': '#2c0d4d',
                '--mp-background-gradient-end': '#1a0a33',
                '--mp-album-art-gradient-start': '#8e44ad',
                '--mp-album-art-gradient-end': '#e74c3c',
                '--mp-album-art-shadow': 'rgba(142, 68, 173, 0.4)',
                '--mp-progress-bar-bg': '#5d2d8b',
                '--mp-progress-gradient-start': '#8e44ad',
                '--mp-progress-gradient-end': '#9b59b6',
                '--mp-control-btn-hover-color': '#9b59b6',
                '--mp-control-btn-active-color': '#8e44ad',
                '--mp-time-info-color': '#c9a0dc'
            },
            anime: {
                '--dark-bg': '#1e1e2e',
                '--darker-bg': '#161622',
                '--accent-blue': '#89dceb',
                '--accent-purple': '#cba6f7',
                '--accent-pink': '#f5c2e7',
                '--surface-color': '#2a2a3a',
                '--card-color': '#3a3a4a',
                '--border-color': '#585b70',
                '--text-primary': '#cdd6f4',
                '--text-secondary': '#a6adc8',
                '--status-success': '#a6e3a1',
                '--status-warning': '#f9e2af',
                '--status-danger': '#f38ba8',
                '--highlight-effect': 'rgba(137, 220, 235, 0.15)',
                // Music Player Specific Variables for Anime Theme
                '--mp-background-gradient-start': '#2a2a3a',
                '--mp-background-gradient-end': '#1e1e2e',
                '--mp-album-art-gradient-start': '#cba6f7',
                '--mp-album-art-gradient-end': '#f5c2e7',
                '--mp-album-art-shadow': 'rgba(203, 166, 247, 0.4)',
                '--mp-progress-bar-bg': '#585b70',
                '--mp-progress-gradient-start': '#cba6f7',
                '--mp-progress-gradient-end': '#89dceb',
                '--mp-control-btn-hover-color': '#89dceb',
                '--mp-control-btn-active-color': '#cba6f7',
                '--mp-time-info-color': '#a6adc8'
            }
        };

        // Helper function for modal/content visibility with transitions
        function toggleVisibility(element, show, displayType = 'flex', transitionDuration = 300) {
            if (show) {
                element.style.display = displayType;
                element.offsetHeight; 
                element.classList.add('visible');
                element.style.pointerEvents = 'auto';
            } else {
                element.classList.remove('visible');
                element.style.pointerEvents = 'none';
                setTimeout(() => {
                    element.style.display = 'none';
                }, transitionDuration);
            }
        }

        // Custom Confirmation Modal Logic
        let confirmModalResolve;
        function showConfirmModal(message, onConfirmCallback = null) {
            return new Promise((resolve) => {
                const modal = document.getElementById('customConfirmModal');
                const confirmMessage = document.getElementById('confirmMessage');
                const confirmYesBtn = document.getElementById('confirmYesBtn');
                const confirmNoBtn = document.getElementById('confirmNoBtn');

                confirmMessage.textContent = message;
                toggleVisibility(modal, true, 'flex');

                confirmModalResolve = resolve;

                confirmYesBtn.onclick = null;
                confirmNoBtn.onclick = null;

                confirmYesBtn.onclick = async () => {
                    toggleVisibility(modal, false);
                    if (onConfirmCallback) await onConfirmCallback();
                    confirmModalResolve(true);
                };
                confirmNoBtn.onclick = () => {
                    toggleVisibility(modal, false);
                    confirmModalResolve(false);
                };
            });
        }

        // Apply theme to the document
        function applyTheme(themeName) {
            const theme = themes[themeName];
            if (!theme) return;

            const root = document.documentElement;
            
            Object.keys(theme).forEach(key => {
                root.style.setProperty(key, theme[key]);
            });

            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.remove('active-theme');
                if (btn.dataset.theme === themeName) {
                    btn.classList.add('active-theme');
                }
            });

            currentTheme = themeName;
            
            if (document.getElementById('analytics-page').classList.contains('active-page')) {
                updateAnalyticsAndChart();
            }
        }

        // Helper function to darken a color
        function darkenColor(color, percent) {
            if (!color || typeof color !== 'string') {
                console.warn("darkenColor received invalid color:", color, ". Using default.");
                return '#888888'; // Return a default grey color
            }
            // Handle hex colors
            if (color.startsWith('#')) {
                let r = parseInt(color.substring(1, 3), 16);
                let g = parseInt(color.substring(3, 5), 16);
                let b = parseInt(color.substring(5, 7), 16);
                
                r = Math.floor(r * (100 - percent) / 100);
                g = Math.floor(g * (100 - percent) / 100);
                b = Math.floor(b * (100 - percent) / 100);
                
                return `#${((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1)}`;
            }
            // Handle rgba colors (if needed, but for this app, hex is primary)
            console.warn("darkenColor currently only supports hex colors. Received:", color);
            return color; // Return original if not hex
        }

        // Enhanced function to draw the bar chart with colors and legend
        function drawBarChart(canvasId, data, labels, colors) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) {
                console.error(`[drawBarChart] Canvas with ID '${canvasId}' not found.`);
                return;
            }
            
            const ctx = canvas.getContext('2d');
            
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.parentElement.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const chartWidth = rect.width;
            const chartHeight = rect.height;
            const barWidth = chartWidth / (data.length * 2.5);
            const spacing = barWidth / 2;
            const maxVal = Math.max(...data);
            const scale = (chartHeight - 60) / (maxVal > 0 ? maxVal : 1);
            const bottomPadding = 40;
            const topPadding = 20;
            
            ctx.strokeStyle = 'var(--border-color)';
            ctx.lineWidth = 0.5;
            
            const gridLineCount = 5;
            for (let i = 0; i <= gridLineCount; i++) {
                const y = chartHeight - bottomPadding - (i * (chartHeight - bottomPadding - topPadding) / gridLineCount);
                ctx.beginPath();
                ctx.moveTo(30, y);
                ctx.lineTo(chartWidth - 10, y);
                ctx.stroke();
                
                ctx.fillStyle = 'var(--text-primary)';
                ctx.font = '12px Inter'; // Changed font
                ctx.textAlign = 'right';
                ctx.fillText(Math.round(maxVal * i / gridLineCount), 25, y + 4);
            }
            
            for (let i = 0; i < data.length; i++) {
                const barHeight = data[i] * scale;
                const x = 40 + i * (barWidth + spacing);
                const y = chartHeight - bottomPadding - barHeight;
                
                const gradient = ctx.createLinearGradient(x, y, x, y + barHeight);
                const color = colors[i % colors.length]; // Use modulo to cycle through colors
                gradient.addColorStop(0, color);
                gradient.addColorStop(1, darkenColor(color, 20));
                
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.roundRect(x, y, barWidth, barHeight, [8, 8, 0, 0]);
                ctx.fill();
                
                ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
                ctx.shadowBlur = 5;
                ctx.shadowOffsetY = 3;
                ctx.fill();
                ctx.shadowColor = 'transparent';
                
                ctx.fillStyle = 'var(--text-primary)';
                ctx.font = 'bold 14px Inter'; // Changed font
                ctx.textAlign = 'center';
                ctx.fillText(data[i], x + barWidth / 2, y - 8);
                
                ctx.fillStyle = 'var(--text-primary)';
                ctx.font = '14px Inter'; // Changed font
                ctx.fillText(labels[i], x + barWidth / 2, chartHeight - 15);
            }
            
            ctx.save();
            ctx.fillStyle = 'var(--text-primary)';
            ctx.font = '14px Inter'; // Changed font
            ctx.textAlign = 'center';
            ctx.translate(15, chartHeight / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('Tatti Score', 0, 0); // Changed back to Tatti Score
            ctx.restore();
        }

        // --- Local Storage Profile Functions ---
        function getLocalProfile() {
            if (!userId) return null;
            const profileJSON = localStorage.getItem(LOCAL_PROFILE_KEY_PREFIX + userId);
            return profileJSON ? JSON.parse(profileJSON) : null;
        }

        function saveLocalProfile(profileData) {
            if (!userId) return;
            localStorage.setItem(LOCAL_PROFILE_KEY_PREFIX + userId, JSON.stringify(profileData));
        }

        async function saveUserProfile(profileData) {
            // Step 1: Save to localStorage and update UI immediately
            saveLocalProfile(profileData);
            userDisplayName = profileData.displayName;
            isAdmin = profileData.isAdmin;
            currentTheme = profileData.theme;
            document.getElementById('displayUserId').textContent = userDisplayName;
            document.getElementById('displayNameInput').value = userDisplayName;
            applyTheme(currentTheme);
            updateAdminPanelUI();
            console.log("Profile saved to localStorage and UI updated.");
        }

        async function loadUserProfile() {
            if (!userId) {
                console.error("loadUserProfile called without userId.");
                return;
            }

            let localProfile = getLocalProfile();

            if (localProfile) {
                console.log("Loading profile from localStorage:", localProfile);
                userDisplayName = localProfile.displayName || userId;
                isAdmin = localProfile.isAdmin || false;
                currentTheme = localProfile.theme || 'original';
            } else {
                console.log("No local profile found. Creating default.");
                userDisplayName = userId;
                isAdmin = false;
                currentTheme = 'original';
                saveLocalProfile({ displayName: userDisplayName, isAdmin, theme: currentTheme });
                showWelcomeModal();
            }

            // Update UI with the determined profile data
            document.getElementById('displayUserId').textContent = userDisplayName;
            document.getElementById('displayNameInput').value = userDisplayName;
            applyTheme(currentTheme);
            updateAdminPanelUI();
            showMainContent();
        }

        async function initializeApp() {
            console.log("[initializeApp] Starting app initialization.");
            // Use a simple local user ID since Firebase is removed
            userId = localStorage.getItem('tatti_local_userId');
            if (!userId) {
                userId = 'user_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('tatti_local_userId', userId);
            }
            console.log(`Using local userId: ${userId}`);
            
            await loadUserProfile();

            initDynamicBackground();
            setupPageSwitching();
            setupThemeSelection();
            renderPlayerProfiles(playersData);
            updateAnalyticsAndChart();
            initAudioPlayer(); // Initialize audio player
        }

        function updateAdminPanelUI() {
            const adminPinSection = document.getElementById('adminPinSection');
            const adminUserListSection = document.getElementById('adminUserListSection');
            
            if (isAdmin) {
                adminPinSection.style.display = 'none';
                adminUserListSection.style.display = 'block';
            } else {
                adminPinSection.style.display = 'flex';
                adminUserListSection.style.display = 'none';
            }
        }

        // Static Player Data
        const playersData = [
            { 
                name: 'Naga Saki', 
                status: 'online', 
                tattiScore: 80, 
                description: 'Naga Saki is known for their consistent performance and is a crucial player for the team. They are considered one of the most intense players.',
                pros: ['Highly respects their mother.'],
                cons: ['Prone to making many mistakes.'],
                imageUrl: 'naga.png',
            },
            { 
                name: 'Ali Khan', 
                status: 'offline', 
                tattiScore: 99, 
                description: 'Ali Khan demonstrates exceptional performance, consistently ranking at the top. They are sometimes referred to as "Tatti" or "Shishimaru" in certain circles. Their fictional father is Barfula Khan, and this player thrives in indoor environments.',
                pros: ['Possesses many mentors/father figures.'],
                cons: ['Only acknowledges Shailu, Ishan, and Rounak as "father" figures.'],
                imageUrl: 'ali.png',
            },
            { 
                name: 'Nxt Figo', 
                status: 'offline', 
                tattiScore: 75, 
                description: 'Nxt Figo is the most respected member of the Nxt group. They are known for having influenced Nxt Sanya for personal gratification.',
                pros: ['Highly respected by everyone.'],
                cons: ['Sanya is their closest friend.'],
                imageUrl: 'figo.png',
            },
            {
                name: 'Rudy',
                status: 'online',
                tattiScore: 88,
                description: 'Rudy, the "Lion of Punjab" in indoor boxing, embodies the fierce spirit of Punjab. He is a renowned boxer, famous for his signature "Whoo Wooo Waa" cry and his peculiar habit of wearing plastic underwear in public. Surprisingly, outside the ring, he has a deep understanding of data analytics and also works as a model.',
                pros: ['Very famous boxer.', 'Unique style, wears plastic underwear in public.', 'Skilled in data analytics.'],
                cons: ['Only analyzes data, does not implement solutions.'],
                imageUrl: 'rudy.png',
            },
            {
                name: 'Yuvi',
                status: 'online',
                tattiScore: 92,
                description: 'Yuvi, a boy from Indoor, resembles a hamster and possesses the unique ability to cut trees with his powerful teeth. His father, Electro (a Spider-Man villain), gifted him a handmade electric bullet.',
                pros: ['His girlfriend is prostitute Jiya.', 'Possesses unique "chainsaw" teeth.'],
                cons: ['Gets beaten daily by "Latringboy".', 'Carries a football everywhere.', 'Owns a powerful bullet but rides a scooter.'],
                 imageUrl: 'yuvi.png',
            },
            {
                name: 'Francture',
                status: 'online',
                tattiScore: 95,
                description: 'Francture is a mythical creature from Japan known as Kappa. He came to India with the goal of passing the JEE exam and is a natural-born chef. At night, he runs a sweet shop called "Francture\'s Rasgulla". He aspired to be an esports player but ended up as an escort girl.',
                pros: ['Resembles a Kappa.', 'Holds a record for making 50 samosas while unclothed.'],
                cons: ['His best friend is Ashiq.', 'Owns an iPhone but doesn\'t have a proper bed.'],
                imageUrl: 'franky.png',
            },
            {
                name: 'Raja Hujjar',
                status: 'busy',
                tattiScore: 98,
                description: "Raja Hujjar, also known as 'Heart Shooter', is a famous Instagram star. He claims to be Neeraj Pepsu's personal chef, for whom he used to make chili potatoes daily while wearing a supporter. He has a broken back, which prevents him from attending school, but he still flexes his back in his reels. His fan following surpasses even the 'Elvish Bhai system'.",
                pros: ['Very kind-hearted (Heart Shooter).', 'Famous Instagram star with a large fan following.', 'Has not been a virgin since 7th grade.'],
                cons: ["Flexes his broken back in reels.", "Always busy thinking about who to pick a fight with today.", "Plays with his brother's cricket kit (it's not stolen)."],
                imageUrl: 'raja.png',
            }
        ];

        function renderPlayerProfiles(players) {
            const playerProfilesGrid = document.getElementById('playerProfilesGrid');
            playerProfilesGrid.innerHTML = '';

            for (const player of players) {
                const prosHtml = player.pros && player.pros.length > 0 ? `
                    <h3>Pros:</h3>
                    <ul class="trait-list-pros">
                        ${player.pros.map(pro => `<li><i class="fas fa-check-circle" style="color: var(--status-success);"></i> ${pro}</li>`).join('')}
                    </ul>
                ` : '<ul class="trait-list-pros"></ul>';

                const consHtml = player.cons && player.cons.length > 0 ? `
                    <h3>Cons:</h3>
                    <ul class="trait-list-cons">
                        ${player.cons.map(con => `<li><i class="fas fa-times-circle" style="color: var(--status-danger);"></i> ${con}</li>`).join('')}
                    </ul>
                ` : '<ul class="trait-list-cons"></ul>';


                const profileCard = document.createElement('div');
                profileCard.className = 'profile-card';
                profileCard.dataset.memberId = player.name.toLowerCase().replace(/\s/g, '-');
                profileCard.innerHTML = `
                    <div class="profile-header">
                        <div class="profile-image">
                            ${player.imageUrl ? `<img src="${player.imageUrl}" alt="${player.name}" onerror="this.onerror=null;this.src='https://placehold.co/80x80/0c1524/00f0ff?text=${player.name.split(' ').map(n=>n[0]).join('')}';">` : `<i class="fas fa-user-circle"></i>`}
                        </div>
                        <div class="profile-info">
                            <h2><span class="player-name-display">${player.name}</span> <span class="profile-status status-${player.status}"><span class="player-status-display">${player.status.charAt(0).toUpperCase() + player.status.slice(1)}</span></span></h2>
                            <div class="profile-meta">
                                <div><i class="fas fa-id-card"></i> Player ID: ${player.name.toLowerCase().replace(/\s/g, '-')}</div>
                            </div>
                        </div>
                    </div>
                    <div class="profile-content">
                        <p class="profile-description-display">${player.description}</p>
                        ${prosHtml}
                        ${consHtml}
                        <ul class="trait-list">
                            <li><i class="fas fa-star"></i> <strong>Tatti Score:</strong> <span class="player-score-display">${player.tattiScore}</span></li>
                            <li><i class="fas fa-gamepad"></i> <strong>Favorite Game:</strong> <span class="player-fav-game-display">Not set</span></li>
                            <li><i class="fas fa-users"></i> <strong>Team Role:</strong> <span class="player-team-role-display">Player</span></li>
                            <li><i class="fas fa-fire"></i> <strong>Play Style:</strong> <span class="player-play-style-display">Adaptive</span></li>
                            <li><i class="fas fa-image"></i> <strong>Image URL:</strong> <span class="player-image-url-display">${player.imageUrl || 'N/A'}</span></li>
                        </ul>
                        <div class="player-actions">
                            ${isAdmin ? `<button class="edit-player-btn" data-player-id="${player.name.toLowerCase().replace(/\s/g, '-')}">Edit Player</button>` : ''}
                        </div>
                    </div>
                `;
                playerProfilesGrid.appendChild(profileCard);
            }
            if (isAdmin) {
                attachPlayerEditListeners();
            }
        }

        function attachPlayerEditListeners() {
            document.querySelectorAll('.edit-player-btn').forEach(button => {
                button.onclick = null;
                button.addEventListener('click', (event) => {
                    const playerId = event.target.dataset.playerId;
                    const playerCard = event.target.closest('.profile-card');
                    startEditPlayer(playerId, playerCard);
                });
            });
        }

        function startEditPlayer(playerId, playerCard) {
            const player = playersData.find(p => p.name.toLowerCase().replace(/\s/g, '-') === playerId);
            if (!player) return;

            playerCard.classList.add('editing');

            playerCard.dataset.originalName = player.name;
            playerCard.dataset.originalStatus = player.status;
            playerCard.dataset.originalScore = player.tattiScore;
            playerCard.dataset.originalDescription = player.description;
            playerCard.dataset.originalPros = JSON.stringify(player.pros || []);
            playerCard.dataset.originalCons = JSON.stringify(player.cons || []);
            playerCard.dataset.originalImageUrl = player.imageUrl || '';

            playerCard.querySelector('.player-name-display').innerHTML = `<input type="text" class="edit-player-name" value="${player.name}">`;
            playerCard.querySelector('.player-status-display').innerHTML = `
                <select class="edit-player-status">
                    <option value="online" ${player.status === 'online' ? 'selected' : ''}>Online</option>
                    <option value="offline" ${player.status === 'offline' ? 'selected' : ''}>Offline</option>
                    <option value="away" ${player.status === 'away' ? 'selected' : ''}>Away</option>
                </select>
            `;
            playerCard.querySelector('.player-score-display').innerHTML = `<input type="number" class="edit-player-score" value="${player.tattiScore}" min="0" max="100">`;
            playerCard.querySelector('.profile-description-display').innerHTML = `<textarea class="edit-player-description">${player.description}</textarea>`;
            playerCard.querySelector('.player-image-url-display').innerHTML = `<input type="text" class="edit-player-image-url" value="${player.imageUrl || ''}" placeholder="Image URL">`;

            const prosList = playerCard.querySelector('.trait-list-pros');
            const consList = playerCard.querySelector('.trait-list-cons');

            prosList.innerHTML = `
                <textarea class="edit-player-pros" placeholder="Enter pros, one per line">${(player.pros || []).join('\n')}</textarea>
            `;
            consList.innerHTML = `
                <textarea class="edit-player-cons" placeholder="Enter cons, one per line">${(player.cons || []).join('\n')}</textarea>
            `;


            const playerActionsDiv = playerCard.querySelector('.player-actions');
            playerActionsDiv.innerHTML = `
                <button class="save-player-btn" data-player-id="${playerId}">Save</button>
                <button class="cancel-player-btn" data-player-id="${playerId}">Cancel</button>
            `;

            playerActionsDiv.querySelector('.save-player-btn').addEventListener('click', () => savePlayerChanges(playerId, playerCard));
            playerActionsDiv.querySelector('.cancel-player-btn').addEventListener('click', () => cancelPlayerEdit(playerId, playerCard));
        }

        function savePlayerChanges(playerId, playerCard) {
            const playerIndex = playersData.findIndex(p => p.name.toLowerCase().replace(/\s/g, '-') === playerId);
            if (playerIndex === -1) return;

            const newName = playerCard.querySelector('.edit-player-name').value.trim();
            const newStatus = playerCard.querySelector('.edit-player-status').value;
            const newScore = parseInt(playerCard.querySelector('.edit-player-score').value);
            const newDescription = playerCard.querySelector('.edit-player-description').value.trim();
            const newPros = playerCard.querySelector('.edit-player-pros').value.split('\n').map(s => s.trim()).filter(s => s);
            const newCons = playerCard.querySelector('.edit-player-cons').value.split('\n').map(s => s.trim()).filter(s => s);
            const newImageUrl = playerCard.querySelector('.edit-player-image-url').value.trim();

            if (!newName || isNaN(newScore) || newScore < 0 || newScore > 100) {
                showConfirmModal('Please enter a valid player name and a Tatti Score between 0 and 100.');
                return;
            }

            playersData[playerIndex].name = newName;
            playersData[playerIndex].status = newStatus;
            playersData[playerIndex].tattiScore = newScore;
            playersData[playerIndex].description = newDescription;
            playersData[playerIndex].pros = newPros;
            playersData[playerIndex].cons = newCons;
            playersData[playerIndex].imageUrl = newImageUrl;

            renderPlayerProfiles(playersData);
            updateAnalyticsAndChart();
            showConfirmModal('Player profile updated (session-only).');
        }

        function cancelPlayerEdit(playerId, playerCard) {
            const originalName = playerCard.dataset.originalName;
            const originalStatus = playerCard.dataset.originalStatus;
            const originalScore = parseInt(playerCard.dataset.originalScore);
            const originalDescription = playerCard.dataset.originalDescription;
            const originalPros = JSON.parse(playerCard.dataset.originalPros);
            const originalCons = JSON.parse(playerCard.dataset.originalCons);
            const originalImageUrl = playerCard.dataset.originalImageUrl;

            const playerIndex = playersData.findIndex(p => p.name.toLowerCase().replace(/\s/g, '-') === playerId);
            if (playerIndex !== -1) {
                playersData[playerIndex].name = originalName;
                playersData[playerIndex].status = originalStatus;
                playersData[playerIndex].tattiScore = originalScore;
                playersData[playerIndex].description = originalDescription;
                playersData[playerIndex].pros = originalPros;
                playersData[playerIndex].cons = originalCons;
                playersData[playerIndex].imageUrl = originalImageUrl;
            }
            
            renderPlayerProfiles(playersData);
            updateAnalyticsAndChart();
            showConfirmModal('Player profile edit cancelled.');
        }


        function updateAnalyticsAndChart() {
            const playerDescriptionsContainer = document.getElementById('playerDescriptions');
            playerDescriptionsContainer.innerHTML = '';

            const sortedPlayers = [...playersData].sort((a, b) => b.tattiScore - a.tattiScore);

            const chartData = [];
            const chartLabels = [];
            const chartColors = currentTheme === 'hacker' ? 
                ['#00ff00', '#00cc00', '#009900', '#006600', '#003300', '#00ff88'] : 
                currentTheme === 'royal' ? 
                ['#9b59b6', '#8e44ad', '#6c3483', '#562d7c', '#401f5c', '#e74c3c'] :
                currentTheme === 'anime' ?
                ['#89dceb', '#cba6f7', '#f5c2e7', '#b5a2e2', '#9786f0', '#f2cdcd'] :
                ['#00f0ff', '#8a2be2', '#ff00d0', '#00aaff', '#ffcc00', '#ff6384'];

            sortedPlayers.forEach((player, index) => {
                chartData.push(player.tattiScore);
                chartLabels.push(player.name);

                const descCard = document.createElement('div');
                descCard.className = 'player-description-card';
                descCard.style.display = 'block';
                descCard.innerHTML = `
                    <h3>${player.name} Performance Analysis:</h3>
                    <p>${player.description}</p>
                `;
                playerDescriptionsContainer.appendChild(descCard);
            });
            
            drawBarChart('playerBarChart', chartData, chartLabels, chartColors);
        }
        
        // --- Side Drawer Logic ---
        const sideDrawer = document.getElementById('sideDrawer');
        const hamburgerBtn = document.getElementById('hamburgerBtn');
        const drawerOverlay = document.getElementById('drawerOverlay');

        function closeDrawer() {
            if (sideDrawer) sideDrawer.classList.remove('open');
            if (hamburgerBtn) hamburgerBtn.classList.remove('clicked');
            if (drawerOverlay) toggleVisibility(drawerOverlay, false);
        }

        function setupPageSwitching() {
            const navLinks = document.querySelectorAll('.main-nav .nav-link');
            const pageContents = document.querySelectorAll('.page-content');

            navLinks.forEach(link => {
                link.addEventListener('click', (event) => {
                    event.preventDefault();
                    const targetId = event.currentTarget.dataset.target;
                    closeDrawer();

                    navLinks.forEach(nav => nav.classList.remove('active'));
                    pageContents.forEach(page => page.classList.remove('active-page'));

                    event.currentTarget.classList.add('active');
                    const targetPage = document.getElementById(targetId);
                    if (targetPage) {
                        targetPage.classList.add('active-page');
                        if (targetId === 'analytics-page') {
                            updateAnalyticsAndChart();
                        } else if (targetId === 'settings-page') {
                            updateAdminPanelUI();
                        } else if (targetId === 'audio-player-page') {
                            // Ensure audio player is initialized and ready
                            initAudioPlayer();
                        }
                    }
                });
            });

            const initialActiveLink = document.querySelector('.main-nav .nav-link.active');
            if (initialActiveLink) {
                const targetId = initialActiveLink.dataset.target;
                const targetPage = document.getElementById(targetId);
                if (targetPage) {
                    targetPage.classList.add('active-page');
                }
            }
        }

        async function handleWelcomeDisplayNameSubmit() {
            const welcomeDisplayNameInput = document.getElementById('welcomeDisplayNameInput');
            const name = welcomeDisplayNameInput.value.trim();

            if (!name) {
                showConfirmModal('Please enter a display name to start exploring.');
                return;
            }
            if (!userId) {
                showConfirmModal('Authentication not ready. Please try again in a moment or refresh the page.');
                return;
            }

            const profileData = { displayName: name, isAdmin, theme: currentTheme };
            await saveUserProfile(profileData);
            
            hideWelcomeModal();
            showMainContent();
        }

        function hideWelcomeModal() {
            const welcomeModal = document.getElementById('welcomeModal');
            toggleVisibility(welcomeModal, false);
        }

        function showWelcomeModal() {
            const welcomeModal = document.getElementById('welcomeModal');
            toggleVisibility(welcomeModal, true, 'flex');
        }

        function showMainContent() {
            const mainContent = document.querySelector('.main-content');
            toggleVisibility(mainContent, true, 'grid');
        }

        function setupThemeSelection() {
            document.querySelectorAll('.theme-btn').forEach(button => {
                button.addEventListener('click', async (event) => {
                    const themeName = event.currentTarget.dataset.theme;
                    const profileData = { displayName: userDisplayName, isAdmin, theme: themeName };
                    await saveUserProfile(profileData);
                });
            });
        }

        function initDynamicBackground() {
            const bg = document.getElementById('dynamic-bg');
            const particleCount = 30;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'dynamic-particle';
                
                const size = Math.random() * 10 + 5;
                const x = Math.random() * 100;
                const y = Math.random() * 100;
                const duration = Math.random() * 20 + 15;
                const delay = Math.random() * 5;
                
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.left = `${x}%`;
                particle.style.top = `${y}%`;
                particle.style.animationDuration = `${duration}s`;
                particle.style.animationDelay = `${delay}s`;
                
                const colors = ['var(--accent-blue)', 'var(--accent-purple)', 'var(--accent-pink)'];
                particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                
                bg.appendChild(particle);
            }
        }

        // --- Audio Player Logic ---
        // DOM Elements
        let ap_albumArt;
        let ap_albumIcon;
        let ap_songTitle;
        let ap_songArtist;
        let ap_progressBar;
        let ap_progress;
        let ap_currentTimeEl;
        let ap_durationEl;
        let ap_playBtn;
        let ap_playIcon;
        let ap_prevBtn;
        let ap_nextBtn;
        let ap_shuffleBtn;
        let ap_repeatBtn;
        let ap_volumeSlider;
        
        // Sample playlist (using placeholder URLs for audio)
        const ap_playlist = [
            {
                title: "Shikari Mode",
                artist: "Naga Saki",
                audioSrc: "audio/shikari mode 1.mp3" // Placeholder
            },
            {
                title: "Shikari Mode 2",
                artist: "Naga Saki",
                audioSrc: "audio/shikari mode 2.mp3"
            },
            {
                title: "404 Groove",
                artist: "API Collective",
                audioSrc: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3"
            }
        ];
        
        // Player state
        let ap_currentTrackIndex = 0;
        let ap_isPlaying = false;
        let ap_isShuffled = false;
        let ap_isRepeated = false;
        let ap_audio = new Audio();

        function getAudioPlayerElements() {
            ap_albumArt = document.getElementById('albumArt');
            ap_albumIcon = document.getElementById('albumIcon');
            ap_songTitle = document.getElementById('songTitle');
            ap_songArtist = document.getElementById('songArtist');
            ap_progressBar = document.getElementById('progressBar');
            ap_progress = document.getElementById('progress');
            ap_currentTimeEl = document.getElementById('currentTime');
            ap_durationEl = document.getElementById('duration');
            ap_playBtn = document.getElementById('playBtn');
            ap_playIcon = document.getElementById('playIcon');
            ap_prevBtn = document.getElementById('prevBtn');
            ap_nextBtn = document.getElementById('nextBtn');
            ap_shuffleBtn = document.getElementById('shuffleBtn');
            ap_repeatBtn = document.getElementById('repeatBtn');
            ap_volumeSlider = document.getElementById('volumeSlider');
        }

        // Initialize player
        function initAudioPlayer() {
            getAudioPlayerElements(); // Get elements after they are in DOM

            if (!ap_audio || !ap_playBtn) {
                console.warn("Audio player elements not found, skipping initialization.");
                return;
            }

            loadTrack(ap_currentTrackIndex);
            
            // Event listeners
            ap_playBtn.addEventListener('click', togglePlay);
            ap_albumArt.addEventListener('click', togglePlay);
            ap_prevBtn.addEventListener('click', prevTrack);
            ap_nextBtn.addEventListener('click', nextTrack);
            ap_progressBar.addEventListener('click', seek);
            ap_volumeSlider.addEventListener('input', setVolume);
            ap_shuffleBtn.addEventListener('click', toggleShuffle);
            ap_repeatBtn.addEventListener('click', toggleRepeat);
            
            // Keyboard shortcuts
            document.removeEventListener('keydown', handleAudioPlayerKeydown); // Remove previous to avoid duplicates
            document.addEventListener('keydown', handleAudioPlayerKeydown);
            
            // Audio event listeners
            ap_audio.addEventListener('timeupdate', updateProgress);
            ap_audio.addEventListener('ended', handleTrackEnd);
            ap_audio.addEventListener('loadedmetadata', updateDuration);
            ap_audio.addEventListener('play', () => {
                ap_isPlaying = true;
                ap_playIcon.classList.replace('bi-play-circle-fill', 'bi-pause-circle-fill');
                ap_albumArt.classList.add('playing');
            });
            ap_audio.addEventListener('pause', () => {
                ap_isPlaying = false;
                ap_playIcon.classList.replace('bi-pause-circle-fill', 'bi-play-circle-fill');
                ap_albumArt.classList.remove('playing');
            });

            // Set initial volume
            ap_audio.volume = ap_volumeSlider.value / 100;
        }
        
        // Load track
        function loadTrack(index) {
            const track = ap_playlist[index];
            ap_audio.src = track.audioSrc;
            ap_songTitle.textContent = track.title;
            ap_songArtist.textContent = track.artist;
            
            // Reset progress
            ap_progress.style.width = '0%';
            ap_currentTimeEl.textContent = '0:00';
            ap_durationEl.textContent = '0:00';
            
            // Load and play if already playing
            if (ap_isPlaying) {
                ap_audio.play().catch(e => console.log('Auto-play prevented (user interaction needed):', e));
            }
        }
        
        // Toggle play/pause
        function togglePlay() {
            if (ap_audio.paused) {
                ap_audio.play().catch(e => console.log('Play failed (user interaction needed):', e));
            } else {
                ap_audio.pause();
            }
        }
        
        // Update progress bar
        function updateProgress() {
            const { currentTime, duration } = ap_audio;
            const progressPercent = (currentTime / duration) * 100;
            ap_progress.style.width = `${progressPercent}%`;
            ap_currentTimeEl.textContent = formatTime(currentTime);
        }
        
        // Update duration
        function updateDuration() {
            ap_durationEl.textContent = formatTime(ap_audio.duration);
        }
        
        // Seek in track
        function seek(e) {
            const width = this.clientWidth;
            const clickX = e.offsetX;
            const duration = ap_audio.duration;
            ap_audio.currentTime = (clickX / width) * duration;
        }
        
        // Seek backward 10 seconds
        function seekBackward() {
            ap_audio.currentTime = Math.max(0, ap_audio.currentTime - 10);
        }
        
        // Seek forward 10 seconds
        function seekForward() {
            ap_audio.currentTime = Math.min(ap_audio.duration, ap_audio.currentTime + 10);
        }
        
        // Previous track
        function prevTrack() {
            ap_currentTrackIndex = (ap_currentTrackIndex - 1 + ap_playlist.length) % ap_playlist.length;
            loadTrack(ap_currentTrackIndex);
            if (ap_isPlaying) ap_audio.play();
        }
        
        // Next track
        function nextTrack() {
            if (ap_isShuffled) {
                ap_currentTrackIndex = Math.floor(Math.random() * ap_playlist.length);
            } else {
                ap_currentTrackIndex = (ap_currentTrackIndex + 1) % ap_playlist.length;
            }
            loadTrack(ap_currentTrackIndex);
            if (ap_isPlaying) ap_audio.play();
        }
        
        // Handle track end
        function handleTrackEnd() {
            if (ap_isRepeated) {
                ap_audio.currentTime = 0;
                ap_audio.play();
            } else {
                nextTrack();
            }
        }
        
        // Set volume
        function setVolume() {
            ap_audio.volume = this.value / 100;
        }
        
        // Increase volume
        function increaseVolume() {
            ap_volumeSlider.value = Math.min(100, parseInt(ap_volumeSlider.value) + 10);
            setVolume.call(ap_volumeSlider);
        }
        
        // Decrease volume
        function decreaseVolume() {
            ap_volumeSlider.value = Math.max(0, parseInt(ap_volumeSlider.value) - 10);
            setVolume.call(ap_volumeSlider);
        }
        
        // Toggle shuffle
        function toggleShuffle() {
            ap_isShuffled = !ap_isShuffled;
            ap_shuffleBtn.classList.toggle('active', ap_isShuffled);
        }
        
        // Toggle repeat
        function toggleRepeat() {
            ap_isRepeated = !ap_isRepeated;
            ap_repeatBtn.classList.toggle('active', ap_isRepeated);
        }
        
        // Format time (mm:ss)
        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        }

        // Keyboard handler for audio player
        function handleAudioPlayerKeydown(e) {
            // Only handle if audio player page is active
            if (!document.getElementById('audio-player-page').classList.contains('active-page')) {
                return;
            }
            if (e.code === 'Space') {
                e.preventDefault();
                togglePlay();
            } else if (e.code === 'ArrowLeft') {
                seekBackward();
            } else if (e.code === 'ArrowRight') {
                seekForward();
            } else if (e.code === 'ArrowUp') {
                increaseVolume();
            } else if (e.code === 'ArrowDown') {
                decreaseVolume();
            }
        }

        // Initial setup on page load
        document.addEventListener('DOMContentLoaded', () => {
            initializeApp();

            window.addEventListener('resize', updateAnalyticsAndChart);

            const saveDisplayNameBtn = document.getElementById('saveDisplayNameBtn');
            if (saveDisplayNameBtn) {
                saveDisplayNameBtn.addEventListener('click', async () => {
                    const name = document.getElementById('displayNameInput').value.trim();
                    const profileData = { displayName: name, isAdmin, theme: currentTheme };
                    await saveUserProfile(profileData);
                    showConfirmModal("Display name updated!");
                });
            }

            const startExploringBtn = document.getElementById('startExploringBtn');
            if (startExploringBtn) {
                startExploringBtn.addEventListener('click', handleWelcomeDisplayNameSubmit);
            }

            const grantAdminBtn = document.getElementById('grantAdminBtn');
            if (grantAdminBtn) {
                grantAdminBtn.addEventListener('click', async () => {
                    const enteredPin = document.getElementById('adminPinInput').value.trim();
                    if (enteredPin === ADMIN_PIN) {
                        const profileData = { displayName: userDisplayName, isAdmin: true, theme: currentTheme };
                        await saveUserProfile(profileData);
                        showConfirmModal('Admin access granted!');
                        document.getElementById('adminPinInput').value = '';
                    } else {
                        showConfirmModal('Incorrect PIN. Please try again.');
                    }
                });
            }

            const revokeAdminBtn = document.getElementById('revokeAdminBtn');
            if (revokeAdminBtn) {
                revokeAdminBtn.addEventListener('click', async () => {
                    await showConfirmModal('Are you sure you want to revoke your admin access?', async () => {
                        const profileData = { displayName: userDisplayName, isAdmin: false, theme: currentTheme };
                        await saveUserProfile(profileData);
                        showConfirmModal('Admin access revoked.');
                    });
                });
            }
            
            if (hamburgerBtn) {
                hamburgerBtn.addEventListener('click', () => {
                    if (sideDrawer) sideDrawer.classList.toggle('open');
                    hamburgerBtn.classList.toggle('clicked');

                    if (sideDrawer && sideDrawer.classList.contains('open')) {
                        toggleVisibility(drawerOverlay, true, 'block');
                    } else {
                        toggleVisibility(drawerOverlay, false);
                    }
                });
            }

            if (drawerOverlay) {
                drawerOverlay.addEventListener('click', () => {
                    closeDrawer();
                });
            }
        });
    </script>
</body>
</html>
